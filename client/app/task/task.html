<div ng-include="'components/navbar/navbar.html'"></div>
<div ng-click="toggle()" style="z-index:999;position:absolute;right:-35px;top:35% ;background-color:#222222;width:70px;height:70px;  border-radius: 35px;    -webkit-transform:rotate(-90deg);   -ms-transform:rotate(-90deg);    -moz-transform:rotate(-90deg);    -webkit-transform:rotate(-90deg);    -o-transform:rotate(-90deg);">
<div style="font-size:14px;color:#FFF;width:70px;height:70px;text-align:center;padding-top:10px; ">Menu</div>
</div>
<!-- BEGIN PAGE CONTENT-->
<div class="" cg-busy="myPromise">
  <script type="text/ng-template" id="memberTemplate.html">
     <a >
        <img class="img-circle" ng-src="{{match.model.avatar}}" err-src="assets/images/avatars/avatar.png" > {{match.model.name}}
     </a>
  </script>
  <script type="text/ng-template" id="activityTemplate.html">
     <a >
       <b >{{match.model.longname}}</b><br/>
       <span>{{match.model.text}}</span>
     </a>
  </script>
  <script type="text/ng-template" id="reOpenModal.html">
    <div class="modal-header">
        <h4 class="modal-title">ReOpen a task
          <img src="assets/images/Defect.png" style="height:150px;" class="pull-right"/>
<small>
<br/><br/>
  If you want to reopen a finished task, please indicate the reason and the new engagement<br /><br />
  </small>
        </h4>
    </div>
    <div class="modal-body" id="modal-body-{{name}}">
        <table class="table table-striped table-hover">
            <tbody style="text-align:left;">
              <tr  tooltip-class="tooltipreopen"  uib-tooltip-html="'Internal is caused by missing or unadapted internal process or training, please comment <br /> External is caused by missing or unadapted interactions with users, please comment'" tooltip-placement="top">
                  <td >
                      <span class="text-muted">Rework Reason
                      </span>
                  </td>
                  <td>
                      <span class="pull-right text-info">
                        <input type="radio" ng-model="selected.reworkReason" value="Internal" ng-required="!reworkReason" >  Internal
                        <input type="radio" ng-model="selected.reworkReason" value="External" ng-required="!reworkReason" style="margin-left:25px;"> External
                      </span>
                  </td>
              </tr>
              <tr>
                  <td>
                      <span class="text-muted">Rework Comment
                      </span>
                  </td>
                  <td>
                      <span class="pull-right text-info">
                        <a href="#" editable-textarea="selected.comment" e-style="width: 380px">{{ selected.comment || 'empty' }}</a>
                      </span>
                  </td>
              </tr>
              <tr>
                  <td>

                  </td>
                  <td>

                  </td>
              </tr>
                <tr>
                    <td>
                        <span class="text-muted">Rework StartDate
                        </span>
                    </td>
                    <td>
                        <span class="pull-right text-info">
                          <!-- <a href="#" editable-bsdate="task.metrics[task.metrics.length-1].targetstartDate" e-is-open="opened.$data" e-ng-click="open($event,'$data')" e-datepicker-popup="mediumDate" e-readonly="true"> -->
                          <md-button class="md-button-slim" ng-click="showDatePicker(selected,'targetstartDate', $event)" aria-label="none" >
                              <span ng-class="{'MandatoryField':selected.targetstartDate === undefined}">{{ (selected.targetstartDate | date:'mediumDate') || 'empty' }}</span>
                          </md-button>
                          <!-- </a> -->
                        </span>
                    </td>
                </tr>
                <tr>
                    <td style="text-align:left">
                        <span class="text-muted">Rework Due Date
                        </span>
                    </td>
                    <td>
                        <span class="pull-right text-info">
                          <!-- <a href="#" editable-bsdate="task.metrics[task.metrics.length-1].targetEndDate" e-is-open="opened.$data" e-ng-click="open($event,'$data')" e-datepicker-popup="mediumDate" e-readonly="true"> -->
                          <md-button class="md-button-slim" ng-click="showDatePicker(selected,'targetEndDate', $event)" aria-label="none" >
                            <span ng-class="{'MandatoryField':selected.targetEndDate === undefined}"> {{ (selected.targetEndDate | date:'mediumDate') || 'empty' }}</span>
                          </md-button>
                          <!-- </a> -->
                        </span>
                    </td>
                </tr>
                <tr>
                    <td style="text-align:left">
                        <span class="text-muted">Rework WorkLoad </span>
                    </td>
                    <td>
                        <span class="pull-right text-info">
                          <a href="#" class="days" e-min="0" e-step="0.001" editable-number="selected.targetLoad" e-style="width: 100px;"  buttons="no" blur="submit">{{selected.targetLoad || 'empty'}}</a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td style="text-align:left">
                        <span class="text-muted">Confidence to succeed</span>
                    </td>
                    <td>
                        <span class="pull-right text-info">
                          <a href="#" e-min="0" e-step="1" editable-number="selected.trust" e-style="width: 100px;"  buttons="no" blur="submit">{{selected.trust || 'empty'}}</a>
                        </span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="modal-footer">
            <button class="btn btn-warning" type="button" ng-click="ok()" ng-disabled="selected.reworkReason === null || selected.comment === null || selected.targetstartDate === null || selected.targetEndDate === null || selected.targetLoad === null ">OK</button>
            <button class="btn btn-default pull-left" type="button" ng-click="cancel()">Cancel</button>
        </div>
</script>
<script type="text/ng-template" id="reOpenAnomaly.html">
  <div class="modal-header">
      <h4 class="modal-title">WhOops, looks like something went wrong.
        <img src="assets/images/problem.jpg" style="height:150px;margin:5px" class="pull-right"/>
<small>
<br/>
Please report with maximum of accucracy your problem to be able to correct it and prevent it to appear again.
<br />
</small>
      </h4>
  </div>
  <div class="modal-body" id="modal-body-{{name}}">
      <table class="table table-striped table-hover">
          <tbody style="text-align:left;">
            <tr >
                <td style="text-align:left">
                    <span class="text-muted">Resume
                    </span>
                </td>
                <td style="text-align:right">
                  <a href="#"  e-style="resize:vertical;width:100%"  editable-textarea="selected.name" buttons="no" blur="submit">{{ selected.name || 'To Complete ' }}</a>
                </td>
            </tr>
            <tr >
                <td style="text-align:left">
                    <span class="text-muted">Category
                    </span>
                </td>
                <td style="text-align:right">
                  <a href="#" editable-checklist="selected.category" e-ng-options="c.value as c.text for c in categories" buttons="no" blur="submit">
                    {{ showCategories() }}
                  </a>
                </td>
            </tr>
            <tr>
                <td style="text-align:left">
                    <span class="text-muted">Impacts
                  </span>
                </td>
                <td style="text-align:right" >
                  <a href="#" editable-select="selected.impact" e-ng-options="c.value as c.text for c in impacts" buttons="no" blur="submit" >
                    {{ showImpacts() }}
                  </a>
                  <a href="#" ng-show="selected.impact" class="days"  e-min="0" e-step="0.001" editable-number="selected.impactWorkload" style="margin-left:10px" e-style="width: 100px;"  buttons="no" blur="submit">{{ selected.impactWorkload || ' Give Details ' }}</a>

                </td>
            </tr>
            <tr uib-tooltip-html="'Give maximum of details to describe the problem with facts : Timeline, KPIs, Process, ... <br /> <br /> You need to be sure that all people who will work on this problem have the same understanding<br /> <br /> Text Area can be enlarge'" tooltip-placement="left">
            <td style="text-align:left">
              <span class="text-muted" >
                Details <small></small>
              </span>
            </td>
            <td style="text-align:right">
              <a href="#"  e-style="resize:vertical;width:100%" editable-textarea="selected.details" buttons="right">{{ selected.details || 'To Complete ' }}</a>
            </td>
          </tr>
          <tr>
              <td style="text-align:left">
                  <span class="text-muted">Due Date
                  </span>
              </td>
              <td>
                  <span class="pull-right text-info">
                    <!-- <a href="#" editable-bsdate="task.metrics[task.metrics.length-1].targetEndDate" e-is-open="opened.$data" e-ng-click="open($event,'$data')" e-datepicker-popup="mediumDate" e-readonly="true"> -->
                    <md-button class="md-button-slim" ng-click="showDatePicker(selected,'dueDate', $event)" aria-label="none" >
                      <span ng-class="{'MandatoryField':selected.dueDate === undefined}"> {{ (selected.dueDate | date:'mediumDate') || 'empty' }}</span>
                    </md-button>
                    <!-- </a> -->
                  </span>
              </td>
          </tr>
          </tbody>
      </table>
  </div>
  <div class="modal-footer">
          <button class="btn btn-warning" type="button" ng-click="ok()" ng-disabled="selected.name === null || selected.impact === null || selected.category === null">OK</button>
          <button class="btn btn-default pull-left" type="button" ng-click="cancel()">Cancel</button>
      </div>
</script>

<div class="row profile" >
    <div class="col-md-12">
        <!--BEGIN TABS-->
        <div class="row profile-nav">
            <!--start col-md-9-->
            <div class="col-md-8">
                <!-- Title -->
                <div class="row">
                    <div class="col-md-2">
                        <img src="assets/images/todo.png" class="img-responsive hidden-xs" style="width:125px;height:125px;" alt="" ng-cloak ng-if="!task.actionPlan && !blnRecurrence"/>
                        <img src="assets/images/action_icon.jpg" class="img-responsive hidden-xs" style="width:125px;height:125px;"  alt="" ng-cloak ng-if="task.actionPlan  === true"/>
                        <img src="assets/images/repeat.png" class="img-responsive hidden-xs" style="width:125px;height:125px;"  alt="" ng-cloak ng-if="blnRecurrence  === true"/>

                    </div>
                    <div class="col-md-10">
                        <div class="row">
                            <div class="col-md-9 col-sm-12 profile-info">
                              <!-- <div class="pull-right hidden-xs" style="margin-top:50px;width:200px" ng-if="needToSave && task._id" ng-cloak uib-tooltip-html="'Save metrics to database'" tooltip-placement="bottom">
                                  <button type="button" name="button" style="width:200px" class="pull-right btn  btn-primary" ng-click="update()" ng-disabled="!(task.name && task.context && task.activity && task.metrics[task.metrics.length-1].targetstartDate && task.metrics[task.metrics.length-1].targetEndDate && task.metrics[task.metrics.length-1].targetLoad && task.metrics[task.metrics.length-1].trust)">Save Data</button>
                              </div> -->
                                <h1>
                                    <a href="#" style="color:black!important" editable-text="task.name" e-style="width: 500px" buttons="right">
                                      {{ task.name || 'Please give a name of your task' }}
                                      <span ng-if="blnRecurrence"> - %DATE%</span>
                                    </a>
                                </h1>
                                <ul class="list list-inline">
                                    <li style="margin-top:5px">
                                      <div class="scrollable-dropdown-menu" style="display:inline-block; ">
                                        <i class="fa fa-flash"></i>
                                        <div class="text-muted" style="margin-right:10px;display:inline-block; ">
                                        Activity
                                        <i class="fa fa-check" style="color:green" ng-if="blnActivityValid"></i>
                                        <i class="fa fa-question" style="color:orange" ng-if="!blnActivityValid"></i>
                                        </div>
                                        <a style="display:inline-block; " href="#" editable-text="task.activity" e-style="width: 500px;display:inline-block;" e-uib-typeahead="activity.longname for activity in activities | filter:$viewValue | limitTo:50" typeahead-min-length="0" typeahead-template-url="memberTemplate.html">
                                          {{task.activity || 'Please give activity' }}
                                        </a>

                                      </div>
                                    </li><br>
                                    <li style="margin-top:5px">
                                      <div class="scrollable-dropdown-menu" style="display:inline-block; ">
                                        <i class="fa fa-map-marker"></i>
                                        <span class="text-muted" style="margin-right:10px">
                                        Context
                                        <i class="fa fa-check" style="color:green" ng-if="blnContextValid"></i>
                                        <i class="fa fa-question" style="color:orange" ng-if="!blnContextValid"></i>
                                        </span>
                                          <a href="#" editable-text="task.context" e-style="width: 500px" e-uib-typeahead="context.longname for context in contexts | filter:$viewValue | limitTo:50">
                                          {{task.context || 'Please give context' }}
                                          <span ng-if="blnRecurrence">.%DATE%</span>
                                        </a>
                                      </div>
                                    </li>
                                    <li style="margin-top:5px" >
                                      <span ng-show="messageCreation" class="label label-danger">  {{messageCreation}}</span>
                                    </li>
                                </ul>
                                <div class="row">
                                    <div class="descriptionTask">
                                        <span ng-if="task.description">Description : </span>
                                        <a href="#" editable-textarea="task.description" style="color:grey!important;margin-right:25px" e-label="Description" e-style="width: 500px">{{ task.description || ' + Description' }}</a>
                                        <div class="" style="height:10px;" ng-if="task.description || task.hypothesis">
                                            <br>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-12 profile-info">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <!-- Title -->
                <div class="row" ng-if="task.previousTasks[0]._id">
                Coming From tasks: <br>
                  <div class="" ng-repeat="previousTask in task.previousTasks">
                    <a href="/task/{{previousTask._id}}">
                      <i class="fa fa-tasks"></i>
                      {{previousTask.name}}
                    </a>
                  </div>
                </div>
                <div class="row" ng-if="task.previousAnomalies[0]._id">
                  Coming From anomalies: <br>
                  <div class="" ng-repeat="previousAnomalie in task.previousAnomalies">
                    <a href="/anomalie/{{previousAnomalie._id}}">
                      <i class="fa fa-exclamation-triangle"></i>
                      {{previousAnomalie.name}}
                    </a>
                  </div>
                </div>
              </div>
        </div>
    </div>
    <!--end col-md-12-->
</div>
<!--end row-->
<div class="row">
    <!--############### PLAN ############  -->

    <div class="col-md-6 col-sm-12" ng-class="{'label-default':task.metrics[task.metrics.length-1].status ==='Not Started','col-lg-3':!blnRecurrence}" style="padding-bottom:10px;">
        <div class="pdcaCol" ng-class="{'label-default':task.metrics[task.metrics.length-1].status ==='Not Started'}">
            PLAN
            <div class="pull-right" ng-if="task.metrics[task.metrics.length-1].status ==='Not Started'">
                <span class="label" ng-class="{'label-info':task.metrics[task.metrics.length-1].status ==='In Progress','label-success':task.metrics[task.metrics.length-1].status ==='Finished','label-default':task.metrics[task.metrics.length-1].status ==='Not Started','label-lightgrey':task.metrics[task.metrics.length-1].status =='Withdrawn'}">
                      {{task.metrics[task.metrics.length-1].status}}
                    </span>
            </div>
        </div>

        <!-- Engagement -->
        <div class="portlet sale-summary" ng-repeat="(key, currentMetric) in task.metrics">
            <div class="portlet-title">
                <div class="caption">
                  <span ng-if="key === 0">Primary </span> <span ng-if="key > 0">Re</span>Engagement <span ng-if="key > 0"> {{key}}</span>
                  <a ng-if="key > 0" class="btn btn-default btn-xs text-muted" ng-click="removeRework($index)" uib-tooltip-html="'Remove this rework from this task'" tooltip-placement="right">
                    <i class="fa fa-trash-o text-muted" aria-hidden="true"></i>
                  </a>
                </div>
                <div class="tools">
                    <div class="pull-right" ng-init="EngagementIsExpanded[key]=(key===task.metrics.length-1 || key===0)" ng-click="EngagementIsExpanded[key]=!EngagementIsExpanded[key]">
                        <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="!EngagementIsExpanded[key]" viewbox="0 0 32 32" title="expand header"><g><g><polygon points="24.158,16.274 22.385,14.5 15.939,20.824 9.615,14.5 7.842,16.274 16,24.432"></polygon></g><g><polygon points="24.158,9.342 22.385,7.568 15.939,13.892 9.615,7.568 7.842,9.342 16,17.5"></polygon></g></g></svg>
                        <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="EngagementIsExpanded[key]" viewbox="0 0 32 32" title="collapse header"><g><g><polygon points="7.842,15.726 9.615,17.5 16.061,11.176 22.385,17.5 24.158,15.726 16,7.568"></polygon></g><g><polygon points="7.842,22.658 9.615,24.432 16.061,18.108 22.385,24.432 24.158,22.658 16,14.5"></polygon></g></g></svg>
                    </div>
                    <span ng-if="key > 0" class="pull-right" style="margin-right:15px;">
                      <span class="label label-warning">
                        <a href="#" editable-select="currentMetric.reworkReason" e-ng-options="s.value as s.text for s in reworkReasons" buttons="no"  blur="submit">
                          <span style="color:white;">
                          {{ showreworkReason(currentMetric) }}
                        </span>
                        </a>
                      </span>
                    </span>
                </div>
            </div>
            <div class="portlet-body" style="padding:0!important" >
                  <table class="table table-striped table-hover">
                    <tbody style="text-align:left;">
                      <!-- DEBUT RECURRENCE -->
                      <!-- **************** -->
                      <tr ng-show="blnRecurrence" style="border:1px blue solid">
                          <td style="text-align:left">
                              <span class="text-muted">Repeats
                              </span>
                          </td>
                          <td>
                              <span class="pull-right text-info">
                                <a href="#" editable-select="task.repeats" e-ng-options="item as item.text for item in repeats track by item.value">
                                    {{task.repeats.text || 'empty'}}
                                  </a>
                              </span>
                          </td>
                      </tr>
                      <tr ng-show="blnRecurrence && task.repeats.value !== 1" style="border:1px blue solid">
                          <td style="text-align:left">
                              <span class="text-muted">Repeat every
                              </span>
                          </td>
                          <td>
                              <span class="pull-right text-info">
                                <a href="#" e-min="0" e-step="1" editable-number="task.repeatEvery" e-style="width: 100px;"  buttons="no" blur="submit">{{task.repeatEvery}}</a>
                                {{task.repeats.label}}
                              </span>
                          </td>
                      </tr>
                      <tr ng-show="blnRecurrence && task.repeats.value === 2" style="border:1px blue solid">
                          <td style="text-align:left">
                              <span class="text-muted">Repeat On
                              </span>
                          </td>
                          <td>
                              <span class="pull-right text-info">
                                  <a href="#" editable-checklist="task.repeatOn" e-ng-options="s.value as s.text for s in repeatOn">
                                    {{ showRepeatOn() }}
                                  </a>
                              </span>
                          </td>
                      </tr>
                      <tr ng-show="blnRecurrence" style="border:1px blue solid">
                          <td style="text-align:left">
                              <span class="text-muted">End after
                              </span>
                          </td>
                          <td>
                              <span class="pull-right text-info">
                                <a href="#" class="days" e-min="0" e-step="1" editable-number="task.repeatEndAfter" e-style="width: 100px;"  buttons="no" blur="submit">{{task.repeatEndAfter }}</a>
                                <small ng-if="task.repeatEndAfter===0" class="text-muted"> (Same day)</small>
                                <small ng-if="task.repeatEndAfter===1" class="text-muted"> (Next day)</small>
                              </span>
                          </td>
                      </tr>

                      <!-- FIN RECURRENCE -->
                      <!-- **************** -->
                      <tr ng-show="!blnRecurrence && currentMetric.reworkReason" >
                          <td>
                              <span class="text-muted">StartDate
                              </span>
                          </td>
                          <td>
                              <span class="pull-right text-info">
                                <!-- <a href="#" editable-bsdate="task.metrics[task.metrics.length-1].targetstartDate" e-is-open="opened.$data" e-ng-click="open($event,'$data')" e-datepicker-popup="mediumDate" e-readonly="true"> -->
                                <md-button class="md-button-slim" ng-click="showDatePicker(currentMetric,'targetstartDate', $event)" aria-label="none" >
                                    <span ng-class="{'mandatoryField':currentMetric.targetstartDate === undefined}">{{ (currentMetric.targetstartDate | date:'mediumDate') || 'empty' }}</span>
                                </md-button>
                                <!-- </a> -->
                              </span>
                          </td>
                      </tr>
                        <tr ng-show="!blnRecurrence" >
                            <td>
                                <span class="text-muted">StartDate
                                </span>
                            </td>
                            <td>
                                <span class="pull-right text-info">
                                  <!-- <a href="#" editable-bsdate="task.metrics[task.metrics.length-1].targetstartDate" e-is-open="opened.$data" e-ng-click="open($event,'$data')" e-datepicker-popup="mediumDate" e-readonly="true"> -->
                                  <md-button class="md-button-slim" ng-click="showDatePicker(currentMetric,'targetstartDate', $event)" aria-label="none" >
                                      <span ng-class="{'mandatoryField':currentMetric.targetstartDate === undefined}">{{ (currentMetric.targetstartDate | date:'mediumDate') || 'empty' }}</span>
                                  </md-button>
                                  <!-- </a> -->
                                </span>
                            </td>
                        </tr>
                        <tr ng-show="!blnRecurrence">
                            <td style="text-align:left">
                                <span class="text-muted">Due Date
                                </span>
                            </td>
                            <td>
                                <span class="pull-right text-info">
                                  <!-- <a href="#" editable-bsdate="task.metrics[task.metrics.length-1].targetEndDate" e-is-open="opened.$data" e-ng-click="open($event,'$data')" e-datepicker-popup="mediumDate" e-readonly="true"> -->
                                  <md-button class="md-button-slim" ng-click="showDatePicker(currentMetric,'targetEndDate', $event)" aria-label="none" >
                                    <span ng-class="{'mandatoryField':currentMetric.targetEndDate === undefined}"> {{ (currentMetric.targetEndDate | date:'mediumDate') || 'empty' }}</span>
                                  </md-button>
                                  <!-- </a> -->
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:left">
                                <span class="text-muted">WorkLoad <small style="font-size:10px"><a href="#" ng-click="standardPERT()"> &gt;&gt; PERT</a></small>
                                </span>
                            </td>
                            <td>
                                <span class="pull-right text-info">
                                  <a href="#" class="days" e-min="0" e-step="0.001" editable-number="currentMetric.targetLoad" e-style="width: 100px;"  buttons="no" blur="submit">{{currentMetric.targetLoad || 'empty'}}</a>
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:left">
                                <span class="text-muted">Hypothesis
                              </span>
                            </td>
                            <td style="text-align:right">
                                <a href="#" style="color:grey!important;" e-label="Hypothesis" editable-textarea="task.hypothesis" buttons="right">{{ task.hypothesis || ' Optional ' }}</a>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:left">
                                <span class="text-muted">Risks
                              </span>
                            </td>
                            <td style="text-align:right" >
                                <a href="#" style="color:grey!important;" e-label="Risks" editable-textarea="task.risks" buttons="right">{{ task.risks || ' Optional' }}</a>
                            </td>
                        </tr>

                    </tbody>
                </table>

            </div>
        </div>

        <!--Todo + Comments  -->
        <div class="portlet sale-summary">
            <div class="portlet-title">
                <div class="caption">
                    TodoList
                </div>
                <div class="tools">
                    <!-- <input type="text" class="myfilter" name="filterToDo" ng-model="filterToDo" placeholder="Filter Todo"> Number : <span class="text-info">{{task.todos.length}}</span> -->
                </div>
            </div>
            <div class="portlet-body" style="padding-bottom:5px;margin-bottom:0px;">
                <div class="row">
                    <div class="form-group" style=";margin-left:20px;padding-bottom:10px">
                        <div class="input-group" style="width:96%">
                            <input class="form-control" type="text" ng-model="newTodo.text" placeholder="Add New Todo" ng-enter="addTodo()">
                            <span class="input-group-btn">
                                <button class="btn btn-outline btn-info" type="button" ng-click="addTodo()">Add</button>
                              </span>
                        </div>
                    </div>
                </div>
                <div class="row">
                  <ul ui:sortable class="todosAnoPanel" ng-model="task.todos" style=";margin-left:15px!important">
                    <li class="todoAno" ng-repeat="todo in task.todos track by $index  ">
                      <div style="padding-left:3px" class="circularToggleButtonView taskCheckboxNodeView " ng-class="todo.isDone ? ' circularToggleButtonView--toggledOn': 'circularToggleButtonView--toggledOff'">
                        <div ng-click="changeStatusTodo($index)" class="circularButtonView circularToggleButtonView-button circularButtonView--xsmall circularButtonView--onWhiteBackground circularButtonView--active">
                          <span class="circularButtonView-label">
                             <svg class="svgIcon " viewbox="0 0 32 32" title="checkmark">
                               <polygon points="27.672,4.786 10.901,21.557 4.328,14.984 1.5,17.812 10.901,27.214 30.5,7.615 "></polygon>
                             </svg>
                           </span>
                        </div>
                        <span ng-class="{'barre':todo.isDone}">
                            <span style="color:black;padding-left:5px" >
                              <a href="#" editable-text="todo.text" buttons="no"  blur="submit">{{ todo.text || 'To Complete ' }}</a>
                          </span>
                        </span>
                      </div>
                      <div class="pull-right sortButtons">
                        <md-button class="md-button-slim" ng-click="$parent.showTodoDatePicker(todo, $event)" aria-label="none" style="min-width:20px!important;margin:0!important;padding:0!important;border-bottom:none;">
                          <small class="text-muted" ng-show="todo.date">{{todo.date |date:'dd MMM' }}</small>
                          <div ng-hide="todo.date" class="circularButtonView circularToggleButtonView-button circularButtonView--small circularButtonView--onWhiteBackground" uib-tooltip-html="'Add a due date to this subtask'" tooltip-placement="bottom">
                            <span class="circularButtonView-label">
                               <svg class="svgIcon task-row-due-date-icon" viewbox="0 0 32 32" title="calendar">
                                 <rect x="16" y="16" width="2" height="2"></rect><rect x="20" y="16" width="2" height="2"></rect>
                                 <rect x="20" y="20" width="2" height="2"></rect><rect x="16" y="20" width="2" height="2"></rect>
                                 <rect x="8" y="20" width="2" height="2"></rect><rect x="8" y="24" width="2" height="2"></rect>
                                 <rect x="16" y="24" width="2" height="2"></rect><rect x="12" y="16" width="2" height="2"></rect>
                                 <rect x="12" y="20" width="2" height="2"></rect><rect x="12" y="24" width="2" height="2"></rect>
                                 <path d="M22,2V0h-2v2h-8V0h-2v2H2v30h28V2H22z M28,30H4V12h24V30z M28,10H4V4h6v2h2V4h8v2h2V4h6V10z"></path>
                               </svg>
                             </span>
                          </div>
                        </md-button>
                        <a ng-click="AssignSubtTaskActor(todo)">
                           <img ng-show="todo.actor" uib-tooltip-html="'{{todo.actor.name}}'" tooltip-placement="bottom" alt="" ng-src="{{todo.actor.avatar}}" style="width:30px;height:30px;" class="img-circle" err-src="assets/images/avatars/avatar.png" />&nbsp;
                           <div ng-hide="todo.actor" class="circularButtonView circularToggleButtonView-button circularButtonView--small circularButtonView--onWhiteBackground" uib-tooltip-html="'Assign this subtask'" tooltip-placement="bottom">
                               <span class="circularButtonView-label">
                             <svg class="svgIcon task-row-assignee-icon" viewbox="0 0 32 32" title="unassigned">
                               <path d="M20.534,16.765C23.203,15.204,25,12.315,25,9c0-4.971-4.029-9-9-9S7,4.029,7,9c0,3.315,1.797,6.204,4.466,7.765C5.962,18.651,2,23.857,2,30c0,0.681,0.065,1.345,0.159,2h27.682C29.935,31.345,30,30.681,30,30C30,23.857,26.038,18.651,20.534,16.765z M9,9c0-3.86,3.14-7,7-7s7,3.14,7,7s-3.14,7-7,7S9,12.86,9,9z M4,30c0-6.617,5.383-12,12-12s12,5.383,12,12H4z"></path>
                             </svg>
                           </span>
                           </div>
                       </a>
                       <a class="btn btn-default btn-xs text-muted" ng-click="removeTodo($index)" uib-tooltip-html="'Remove this todo from this task'" tooltip-placement="left">
                         <i class="fa fa-trash-o text-muted" aria-hidden="true"></i>
                       </a>
                        <!-- <button type="button" class=" " aria-hidden="true" ng-click="deleteTodo(todo)">&times;</button> -->
                      </div>
                    </li>
                    <li ng-show="blnAssignSubtaskActor">
                      <input class="mysearchname" type="text" placeholder="Name" ng-model="subtaskactorselected" uib-typeahead="member as member.name for member in members | filter:$viewValue:memberNamesWith | limitTo:5" typeahead-min-length="0" typeahead-template-url="memberTemplate.html">
                      <span class="btn btn-primary" ng-click="addSubTaskActor(subtaskactorselected)">Add</span>
                      <span class="task-or">or</span>
                      <span class="btn btn-info  btn-sm btn-outline" ng-click="addMeToSubTaskActor()" ng-show="!mePresentInSubTaskActors">Assign to Me</span>
                      <span class="btn btn-info  btn-sm btn-outline" ng-click="removeMeToSubTaskActor()" ng-show="mePresentInSubTaskActors">Unassign to Me</span>
                    </li>
                  </ul>

                </div>
            </div>

        </div>

        <!-- Team -->
        <div class="portlet sale-summary">
            <div class="portlet-title">
                <div class="caption">
                    Team
                </div>
                <div class="tools">
                    <div class="pull-right" ng-click="TeamIsExpanded=!TeamIsExpanded">
                        <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="!TeamIsExpanded" viewbox="0 0 32 32" title="expand header"><g><g><polygon points="24.158,16.274 22.385,14.5 15.939,20.824 9.615,14.5 7.842,16.274 16,24.432"></polygon></g><g><polygon points="24.158,9.342 22.385,7.568 15.939,13.892 9.615,7.568 7.842,9.342 16,17.5"></polygon></g></g></svg>
                        <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="TeamIsExpanded" viewbox="0 0 32 32" title="collapse header"><g><g><polygon points="7.842,15.726 9.615,17.5 16.061,11.176 22.385,17.5 24.158,15.726 16,7.568"></polygon></g><g><polygon points="7.842,22.658 9.615,24.432 16.061,18.108 22.385,24.432 24.158,22.658 16,14.5"></polygon></g></g></svg>
                    </div>
                    <span class="pull-right" style="margin-right:15px;"><small>Number:</small>  <span class="text-info">  {{task.actors.length + task.followers.length}}</span></span>
                </div>
            </div>
            <div class="portlet-body" style="padding-bottom:0!important;margin-bottom:0px;" ng-show="TeamIsExpanded">
                <ul class="list-unstyled" style="margin-bottom:0!important">
                    <li class="TaskActors-facepile">
                        <div class="pull-left" style="color:#898E95;width:65px;">Actors</div>
                        <div class="pull-left RemovableAvatar TaskActors-facepileAvatar" ng-repeat="actor in task.actors ">
                            <img uib-tooltip-html="'{{actor.name}}'" tooltip-placement="right" alt="" ng-src="{{actor.avatar}}" style="width:35px;height:35px;" class="img-circle" err-src="assets/images/avatars/avatar.png" />
                            <a class="RemoveButton RemovableAvatar-avatarRemoveButton" ng-click="removeActor(actor, $index)">
                              <div uib-tooltip-html="'Remove actor'" style="width:15px;height:15px;color:white;background-color:#1aafd0;"
                              tooltip-placement="right" class="circularButtonView add-button detailsFollowersView-addButton circularButtonView--small circularButtonView--onWhiteBackground circularButtonView--active">
                                  <span class="circularButtonView-label">
                                    <svg class="svgIcon XIcon RemoveButton-xIcon" title="XIcon" viewbox="0 0 32 32">
                                      <polygon points="24.485,27.314 27.314,24.485 18.828,16 27.314,7.515 24.485,4.686 16,13.172 7.515,4.686 4.686,7.515 13.172,16 4.686,24.485 7.515,27.314 16,18.828 "></polygon>
                                    </svg>
                                  </span>
                              </div>
                            </a>
                        </div>
                        <a href="#" ng-click="openAddActorBox()" ng-hide="blnAddActor">
                        <div uib-tooltip-html="'Add an actor to this task not yet involved.'" tooltip-placement="bottom" class="circularButtonView add-button detailsFollowersView-addButton circularButtonView--small circularButtonView--onWhiteBackground circularButtonView--active">
                            <span class="circularButtonView-label">
                              <svg class="svgIcon add-followers-icon" viewbox="0 0 32 32" title="plus">
                                <polygon points="28,14 18,14 18,4 14,4 14,14 4,14 4,18 14,18 14,28 18,28 18,18 28,18"></polygon>
                              </svg>
                            </span>
                        </div>
                      </a>
                      <a href="#"  ng-show="blnAddActor" ng-click="closeAddActorBox()">
                        <span class="btn btn-default  btn-sm btn-outline">Cancel</span>
                      </a>
                    </li>
                      <li ng-show="blnAddActor">
                            <input id="actorselected" class="mysearchname" type="text" placeholder="Name" ng-model="actorselected" uib-typeahead="member as member.name for member in members | filter:$viewValue:memberNamesWith | limitTo:5" typeahead-min-length="0" typeahead-template-url="memberTemplate.html">
                            <span class="btn btn-primary" ng-click="addActor(actorselected)">Add</span>
                            <span class="task-or">or</span>
                            <span class="btn btn-info  btn-sm btn-outline" ng-click="addMeToActor()" ng-show="!mePresentInActors">Assign to Me</span>
                            <span class="btn btn-info  btn-sm btn-outline" ng-click="removeMeToActor()" ng-show="mePresentInActors">Unassign to Me</span>

                      </li>
                    <li>
                        <div class="pull-left" style="color:#898E95;width:65px;">Followers</div>
                        <div class="pull-left  RemovableAvatar TaskActors-facepileAvatar" ng-repeat="actor in task.followers">
                            <img uib-tooltip-html="'{{actor.name}}'" tooltip-placement="right" alt="" ng-src="assets/images/avatars/{{actor._id}}.png" style="width:30px;height:30px" class="img-circle" err-src="assets/images/avatars/avatar.png" />
                            <a class="RemoveButton RemovableAvatar-avatarRemoveButton" ng-click="removeFollower(actor, $index)">
                              <div uib-tooltip-html="'Remove follower'" style="width:15px;height:15px;color:white;background-color:#1aafd0;"
                              tooltip-placement="right" class="circularButtonView add-button detailsFollowersView-addButton circularButtonView--small circularButtonView--onWhiteBackground circularButtonView--active">
                                  <span class="circularButtonView-label">
                                    <svg class="svgIcon XIcon RemoveButton-xIcon" title="XIcon" viewbox="0 0 32 32">
                                      <polygon points="24.485,27.314 27.314,24.485 18.828,16 27.314,7.515 24.485,4.686 16,13.172 7.515,4.686 4.686,7.515 13.172,16 4.686,24.485 7.515,27.314 16,18.828 "></polygon>
                                    </svg>
                                  </span>
                              </div>
                            </a>
                        </div>
                        <a id="addFollower" href="#" ng-click="openAddFollowerBox()" ng-hide="blnAddFollower">
                          <div uib-tooltip-html="'Add a follower to this task.<br />Followers don\'t have actions in tasks '" tooltip-placement="bottom" class="circularButtonView add-button detailsFollowersView-addButton circularButtonView--small circularButtonView--onWhiteBackground circularButtonView--active">
                              <span class="circularButtonView-label">
                                <svg class="svgIcon add-followers-icon" viewbox="0 0 32 32" title="plus">
                                  <polygon points="28,14 18,14 18,4 14,4 14,14 4,14 4,18 14,18 14,28 18,28 18,18 28,18"></polygon>
                                </svg>
                              </span>
                          </div>
                        </a>
                        <a href="#"  ng-show="blnAddFollower" ng-click="closeAddFollowerBox()">
                          <span class="btn btn-default  btn-sm btn-outline">Cancel</span>
                        </a>
                      </li>
                      <li ng-show="blnAddFollower">
                            <input  id="followerselected"  class="mysearchname" type="text" placeholder="Name" ng-model="followerselected" uib-typeahead="member as member.name for member in members | filter:$viewValue:memberNamesWith | limitTo:5" typeahead-min-length="0" typeahead-template-url="memberTemplate.html">
                            <span class="btn btn-primary" ng-click="addFollower(followerselected)">Add</span>
                            <span class="task-or">or</span>
                            <span class="btn btn-info  btn-sm btn-outline" ng-click="addMeToFollower()" ng-show="!mePresentInFollowers">Assign to Me</span>
                            <span class="btn btn-info  btn-sm btn-outline" ng-click="removeMeToFollower()" ng-show="mePresentInFollowers">Unassign to Me</span>

                      </li>
                </ul>
            </div>
        </div>
    </div>
    <!--############### DO ############  -->
    <div class="col-md-6 col-sm-12" ng-class="{'label-info':task.metrics[task.metrics.length-1].status ==='In Progress','col-lg-3':!blnRecurrence}" style="padding-bottom:20px;" ng-if="!openedPERT">
        <div class="pdcaCol" ng-class="{'label-info':task.metrics[task.metrics.length-1].status ==='In Progress'}">
            DO
            <div class="pull-right" >
                <span class="label" ng-if="task.metrics[task.metrics.length-1].status ==='In Progress'" ng-class="{'label-info':task.metrics[task.metrics.length-1].status ==='In Progress','label-success':task.metrics[task.metrics.length-1].status ==='Finished','label-default':task.metrics[task.metrics.length-1].status ==='Not Started','label-lightgrey':task.metrics[task.metrics.length-1].status =='Withdrawn'}">
                      {{task.metrics[task.metrics.length-1].status}}
                    </span>
            </div>
        </div>
        <!-- Alerts -->
        <div class="" id="Alert" style="margin-bottom:0!important">
            <div class="portlet sale-summary" ng-if="task._id && !blnRecurrence">
                <div class="portlet-title">
                    <div class="caption">
                        Alerts
                    </div>
                    <div class="tools">
                      <span class="pull-right" style="margin-right:15px;"><small>Number:</small>  <span class="text-info">  {{task.alerts.length}}</span></span>
                    </div>
                </div>
                <div class="portlet-body" style="padding:0!important">
                    <table class="table table-striped table-hover">
                        <tbody style="text-align:center;">
                            <tr ng-repeat="KPI in task.alerts | orderBy:'constraint' track by $index" on-finish-render uib-tooltip-html="'Contraint : {{KPI.constraint}}<br /> <br /> Description :  {{KPI.description}}  <br /> Suggestion :  {{KPI.suggestion}}'" tooltip-placement="right"  tooltip-class="tooltipkpi" >
                                <td style="text-align:left;width:65%">
                                  <a href="/KPI/{{KPI._id}}?type=task&typeid={{task._id}}">{{KPI.name}}</a>
                                  <!-- <br ng-if="KPI.name==='Predicted OverCharge'"><small ng-if="KPI.name==='Predicted OverCharge'" class="text-muted">Projected WorkLoad </small> -->
                                </td>
                                <td style="text-align:left;width:35%;font-size:13px">
                                    <span ng-if="KPI.calcul.task !== undefined && KPI.calcul.task !== null" class="badge" ng-style="{'background-color':giveMeMyColor(KPI.calcul.task, KPI.category)}" style="height:15px;line-height:10px;width:15px;margin-right: 10px">&nbsp;</span>
                                    <span class="text-muted days" ng-if="KPI.name==='Predicted OverCharge'">
                                    <span ng-if="task.metrics[task.metrics.length-1].projectedWorkload">  {{parseFloat((task.metrics[task.metrics.length-1].projectedWorkload - task.metrics[task.metrics.length-1].targetLoad).toFixed(2))}}</span>
                                    <span ng-if="!task.metrics[task.metrics.length-1].projectedWorkload">0</span>
                                    </span>
                                    <span class="text-muted days" ng-if="KPI.name==='Delivery Overdue'">
                                      {{task.metrics[task.metrics.length-1].delay ||0}}
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!--Metrics  -->
            <div class="portlet sale-summary" ng-repeat="(key, currentMetric) in task.metrics" >
                <div class="portlet-title">
                    <div class="caption">
                        <span ng-if="key === 0">Primary </span> <span ng-if="key > 0">Re</span>work <span ng-if="key > 0"> {{key}}</span>
                    </div>
                    <div class="tools">
                        <div class="pull-right" ng-init="MetricIsExpanded[key]=(key===task.metrics.length-1)" ng-click="MetricIsExpanded[key]=!MetricIsExpanded[key]">
                            <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="!MetricIsExpanded[key]" viewbox="0 0 32 32" title="expand header"><g><g><polygon points="24.158,16.274 22.385,14.5 15.939,20.824 9.615,14.5 7.842,16.274 16,24.432"></polygon></g><g><polygon points="24.158,9.342 22.385,7.568 15.939,13.892 9.615,7.568 7.842,9.342 16,17.5"></polygon></g></g></svg>
                            <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="MetricIsExpanded[key]" viewbox="0 0 32 32" title="collapse header"><g><g><polygon points="7.842,15.726 9.615,17.5 16.061,11.176 22.385,17.5 24.158,15.726 16,7.568"></polygon></g><g><polygon points="7.842,22.658 9.615,24.432 16.061,18.108 22.385,24.432 24.158,22.658 16,14.5"></polygon></g></g></svg>
                        </div>
                    </div>
                </div>
                <div class="portlet-body" style="padding:0!important" ng-show="MetricIsExpanded[key]">
                    <table class="table table-striped table-hover">
                        <tbody style="text-align:left;">

                            <tr ng-if="task._id && !blnRecurrence">
                                <td>
                                    <span class="text-muted">Real StartDate
                                    </span>
                                </td>
                                <td>
                                    <span class="pull-right text-info" ng-class="{'bg-info text-info':currentMetric.lateStart}">
                                        <md-button class="md-button-slim" ng-click="showDatePicker(currentMetric,'startDate', $event)" aria-label="none" >
                                          <span ng-class="{'mandatoryField':currentMetric.startDate === undefined}"> {{(currentMetric.startDate | date:'mediumDate') || 'Wait to start' }}</span>
                                        </md-button>
                                    </span>
                                </td>
                            </tr>
                            <tr ng-if="task._id && !blnRecurrence">
                                <td style="text-align:left">
                                    <span class="text-muted">Best Delivery Date
                                    </span>
                                </td>
                                <td>
                                    <span class="pull-right text-info" ng-class="{'bg-info text-info':currentMetric.lateEnd}">
                                      <md-button class="md-button-slim" ng-click="showDatePicker(currentMetric,'endDate', $event)" aria-label="none" >
                                        <span ng-if="currentMetric.endDate"> {{currentMetric.endDate | date:'mediumDate'}}</span>
                                        <span ng-if="!currentMetric.endDate"> {{ currentMetric.targetEndDate | date:'mediumDate'}}</span>
                                      </md-button>
                                    </span>
                                </td>
                            </tr>
                            <tr ng-if="task._id  && !blnRecurrence">
                                <td style="text-align:left">

                                </td>
                                <td>

                                </td>
                            </tr>
                            <tr ng-if="task._id  && !blnRecurrence">
                                <td style="text-align:left" >
                                    <span class="text-muted">Spent Time
                                    </span>
                                </td>
                                <td>
                                    <span class="pull-right text-info">
                                      <a href="#" class="days" ng-class="{'mandatoryField':currentMetric.timeSpent === 0}" e-min="0" e-step="0.001" editable-number="currentMetric.timeSpent" e-style="width: 100px;"  buttons="no" blur="submit">{{currentMetric.timeSpent}}</a>
                                    </span>
                                </td>
                            </tr>
                            <tr ng-if="task._id  && !blnRecurrence">
                                <td style="text-align:left">
                                    <span class="text-muted"><a href="" ng-click="markAsDone(key)">Progress <img ng-if="currentMetric.progress === 0" src="assets/images/animated-check.gif" style="width:25px;height:25px;" alt=""></a>
                                  </span>
                                </td>
                                <td style="text-align:right;">
                                    <span style=" display:inline">
                                      <!-- <uib-progressbar value="currentMetric.progress" style="margin-bottom:0;height:15px;" type="info"></uib-progressbar> -->
                                      <a href="#" class="pourcentage" ng-class="{'mandatoryField':currentMetric.progress === 0}" e-min="0" e-max="100" editable-number="currentMetric.progress" e-style="width: 100px;" buttons="no" blur="submit">{{currentMetric.progress}}</a>
                                    </span>
                                </td>
                            </tr>
                            <tr ng-if="task._id  && !blnRecurrence">
                                <td style="text-align:left">

                                </td>
                                <td>

                                </td>
                            </tr>
                            <tr>
                                <td style="text-align:left">
                                    <span class="text-muted">Confidence to succeed
                                            </span>
                                </td>
                                <td>
                                    <span class="pull-right text-info">
                                      <a href="#" class="pourcentage" e-min="0"  e-max="100" e-step="1" editable-number="currentMetric.trust" e-style="width: 100px"  buttons="no" blur="submit">{{ currentMetric.trust || 'empty'}}</a>
                                    </span>
                                </td>
                            </tr>
                            <tr ng-if="task._id  && !blnRecurrence">
                              <td style="text-align:left">

                              </td>
                              <td>
                              </td>

                              </tr>
                            <tr ng-if="task._id  && !blnRecurrence && currentMetric.status ==='Finished'">
                                <td style="text-align:left">
                                    <span class="text-muted">
                                      User Satisfaction
                                    </span>
                                    <span id="toggleTodo" ng-click="currentMetric.blnSentUser = !currentMetric.blnSentUser">
                                      <button  type="button" class="btn btn-toggle btn-toggle-text-usersatis" ng-class="{'active':currentMetric.blnSentUser }" data-toggle="button" aria-pressed="false" autocomplete="off" >
                                        <span class="handle"></span>
                          </button>
                          </span>
                                </td>
                                <td>
                                    <span class="pull-right text-info">
                                      <a class="pourcentage"  ng-class="{'notMandatoryField':currentMetric.status !=='Finished'}" href="#" e-min="0" e-max="200" editable-number="currentMetric.userSatisfaction" e-style="width: 100px;" buttons="no" blur="submit">{{ currentMetric.userSatisfaction || 'empty'}}</a>
                                    </span>
                                </td>
                            </tr>
                            <tr ng-if="task._id  && !blnRecurrence && currentMetric.status ==='Finished'">
                                <td style="text-align:left">
                                    <span class="text-muted">  Actor Satisfaction
                                            </span>
                                </td>
                                <td>
                                    <span class="pull-right text-info">
                                      <a class="pourcentage"  href="#" ng-class="{'notMandatoryField':currentMetric.status !=='Finished'}" e-min="0" e-max="200" editable-number="currentMetric.actorSatisfaction" e-style="width: 100px;" buttons="no" blur="submit">{{ currentMetric.actorSatisfaction || 'empty'}}</a>
                                      </span>
                                </td>
                            </tr>
                            <tr ng-if="task._id  && !blnRecurrence && currentMetric.status ==='Finished'">
                                <td style="text-align:left">
                                    <span class="text-muted">Full Delivery
                                              </span>
                                </td>
                                <td>
                                    <span class="pull-right text-info">
                                    <a href="#" class="pourcentage"   ng-class="{'notMandatoryField':currentMetric.status !=='Finished'}" e-min="0" e-max="200" editable-number="currentMetric.deliverableStatus" e-style="width: 100px;" buttons="no" blur="submit">{{ currentMetric.deliverableStatus || 'empty'}}</a>
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                </div>
            </div>
            <div class="pull-right" style="width:200px" ng-if="!task._id" uib-tooltip-html="'You must fill the 7 mandatories fields : name, activity, context, startDate, Estimate workload, DueDate and confidence to be able to save'" tooltip-placement="bottom">
                <button ng-if="!blnRecurrence" type="button" name="button" style="width:200px" class="btn  btn-primary" ng-click="create()" ng-disabled="!(task.name && task.context && task.activity && task.metrics[0].targetstartDate && task.metrics[0].targetEndDate && task.metrics[0].targetLoad && task.metrics[0].trust)">Create</button>
                <button ng-if="blnRecurrence" type="button" name="button" style="width:200px" class="btn  btn-primary" ng-click="create()" ng-disabled="!(task.name && task.context && task.activity && task.metrics[0].targetLoad && task.metrics[0].trust)">Create</button>
            </div>

            <div class="portlet sale-summary" ng-if="task._id && !blnRecurrence" >
                <div class="portlet-title">
                    <div class="caption">
                        Information
                    </div>
                    <div class="tools">
                      <!-- <input type="text" class="myfilter" name="filterComments" ng-model="filterComments" placeholder="Filter Comments" style="margin-left:15px;"> -->
                        <div class="pull-right" ng-click="CommentIsExpanded=!CommentIsExpanded">
                            <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="!CommentIsExpanded" viewbox="0 0 32 32" title="expand header"><g><g><polygon points="24.158,16.274 22.385,14.5 15.939,20.824 9.615,14.5 7.842,16.274 16,24.432"></polygon></g><g><polygon points="24.158,9.342 22.385,7.568 15.939,13.892 9.615,7.568 7.842,9.342 16,17.5"></polygon></g></g></svg>
                            <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="CommentIsExpanded" viewbox="0 0 32 32" title="collapse header"><g><g><polygon points="7.842,15.726 9.615,17.5 16.061,11.176 22.385,17.5 24.158,15.726 16,7.568"></polygon></g><g><polygon points="7.842,22.658 9.615,24.432 16.061,18.108 22.385,24.432 24.158,22.658 16,14.5"></polygon></g></g></svg>
                        </div>
                        <span class="pull-right" style="margin-right:15px;"><small>Number:</small>  <span class="text-info">  {{manualComments.length}}</span></span>
                    </div>
                </div>
                <div class="portlet-body" style="padding:10px;" ng-show="CommentIsExpanded">
                    <div class="form-group" style="padding-bottom:10px;display:flex">
                        <div class="">
                            <img uib-tooltip-html="'{{currentUser.name}}'" tooltip-placement="bottom" alt="" ng-src="assets/images/avatars/{{currentUser._id}}.png" style="width:30px;height:30px" class="img-circle" err-src="assets/images/avatars/avatar.png" />
                        </div>
                        <div class="input-group" style="width:90%;padding-left:16px;">
                            <input class="form-control " type="text" ng-model="comment.text" placeholder="Add a comment, an info or a link" ng-enter="addComment()">
                            <span class="input-group-btn">
                <button class="btn btn-outline btn-info" type="button" ng-click="addComment()">Comment</button>
              </span>
                        </div>
                    </div>
                    <div class="dont-break-out">
                        <ul class="dont-break-out" style="padding-left:0px;-webkit-padding-start: 0px!important;">
                            <li class="commentTask" ng-repeat="comment in task.comments | orderBy:'-date' | filter:filterComments | filter:{auto:false} track by $index" style="min-height:40px;height:auto;padding:10px 0 0 0!important;display:flex;vertical-align: middle;">
                                <div class="" style="min-width:50px;">
                                    <div class="" style="display:inline-flex">
                                        <img uib-tooltip-html="'{{comment.user.name}} <br/>
                                        {{comment.date | date:'MMM d, y HH:mm '}}'" tooltip-placement="bottom" alt="" ng-src="{{comment.user.avatar}}" style="width:25px;height:25px" ng-class="{'imageTransparent':comment.auto}" class="img-circle" err-src="assets/images/avatars/avatar.png" />
                                        <svg ng-if="!comment.auto" style="width:16px;height:16px;color:#B9BCC0;fill:grey;margin-top:-8px;" class="svgIco" viewbox="0 0 32 32" title=""><path d="M19,2c6.065,0,11,4.935,11,11s-4.935,11-11,11h-5.19L8,28.126v-5.282l-0.919-0.59C3.899,20.211,2,16.751,2,13C2,6.935,6.935,2,13,2H19 M19,0h-6C5.832,0,0,5.832,0,13c0,4.59,2.398,8.623,6,10.937V32l8.448-6H19c7.168,0,13-5.832,13-13S26.168,0,19,0L19,0z"></path></svg>
                                    </div>
                                    <br><span class="dateComment">{{comment.date | date:'d MMM'}}</span>
                                </div>

                                <div class="dont-break-out" style="width:80%">
                                    <span class="autoComment" ng-if="comment.auto === 2" style="color:rgba(91, 103, 133, 0.5)">{{comment.user.name}} </span>
                                    <span class="" ng-class="{'autoComment':comment.auto}" ng-bind-html="comment.text | embed:{sanitizeHtml:false,linkTarget:'_blank'}"></span>
                                </div>
                                <a class="btn  btn-xs text-muted pull-right" ng-click="removeComment(comment)" uib-tooltip-html="'Remove forever this comment'" tooltip-placement="left">
                                  <i class="fa fa-trash-o text-muted" aria-hidden="true"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
    </div>
    <div class="col-md-6 col-sm-12" ng-class="{'label-success':task.metrics[task.metrics.length-1].status ==='Finished','label-lightgrey':task.metrics[task.metrics.length-1].status =='Withdrawn','col-lg-3':!blnRecurrence}" style="padding-bottom:20px;" ng-if="!openedPERT">
        <div class="pdcaCol" ng-class="{'label-success':task.metrics[task.metrics.length-1].status ==='Finished','label-lightgrey':task.metrics[task.metrics.length-1].status =='Withdrawn'}">
            CHECK
            <div class="pull-right" ng-if="task.metrics[task.metrics.length-1].status ==='Finished' || task.metrics[task.metrics.length-1].status =='Withdrawn'">
                <span class="label" >
                      {{task.metrics[task.metrics.length-1].status}}
                    </span>
            </div>
        </div>

        <!-- KPIs -->
        <div class="" id="KPI" ng-if="!blnRecurrence">
            <div class="portlet sale-summary" ng-if="task._id">
                <div class="portlet-title">
                    <div class="caption">
                        KPIs
                    </div>
                    <div class="tools">
                        <div class="pull-right" ng-click="KPIIsExpanded=!KPIIsExpanded">
                            <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="!KPIIsExpanded" viewbox="0 0 32 32" title="expand header"><g><g><polygon points="24.158,16.274 22.385,14.5 15.939,20.824 9.615,14.5 7.842,16.274 16,24.432"></polygon></g><g><polygon points="24.158,9.342 22.385,7.568 15.939,13.892 9.615,7.568 7.842,9.342 16,17.5"></polygon></g></g></svg>
                            <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="KPIIsExpanded" viewbox="0 0 32 32" title="collapse header"><g><g><polygon points="7.842,15.726 9.615,17.5 16.061,11.176 22.385,17.5 24.158,15.726 16,7.568"></polygon></g><g><polygon points="7.842,22.658 9.615,24.432 16.061,18.108 22.385,24.432 24.158,22.658 16,14.5"></polygon></g></g></svg>
                        </div>
                        <span class="pull-right" style="margin-right:15px;"><small>Number:</small>  <span class="text-info">  {{task.kpis.length}}</span></span>
                    </div>
                </div>
                <div class="portlet-body" style="padding:0!important" ng-show="KPIIsExpanded">
                    <table class="table table-striped table-hover">
                        <tbody style="text-align:center;">
                            <tr ng-repeat="KPI in task.kpis | orderBy:'constraint' track by $index" on-finish-render uib-tooltip-html="'Contraint : {{KPI.constraint}}<br /> <br /> Description :  {{KPI.description}}  <br /> Suggestion :  {{KPI.suggestion}}'" tooltip-placement="left"  tooltip-class="tooltipkpi"  >
                                <td style="text-align:left;width:65%"><a href="/KPI/{{KPI._id}}?type=task&typeid={{task._id}}">{{KPI.name}}</a></td>
                                <td style="text-align:left;width:35%;font-size:13px">
                                    <span ng-if="KPI.calcul.task !== undefined && KPI.calcul.task !== null" class="badge" ng-style="{'background-color':giveMeMyColor(KPI.calcul.task, KPI.category)}" style="height:15px;line-height:10px;width:15px;margin-right: 10px">&nbsp;&nbsp;</span> {{KPI.calcul.task}}
                                    <span ng-if="KPI.category === 'Goal' && KPI.calcul.task !== undefined && KPI.calcul.task !== null"> %</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- Anomalies -->
        <div class="" id="Anomalies" ng-if="!blnRecurrence">
            <div class="portlet sale-summary" ng-if="task._id">
                <div class="portlet-title">
                    <div class="caption">
                        Anomalies
                    </div>
                    <div class="tools">
                        <div class="pull-right" ng-click="AnomalyIsExpanded=!AnomalyIsExpanded">
                            <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="!AnomalyIsExpanded" viewbox="0 0 32 32" title="expand header"><g><g><polygon points="24.158,16.274 22.385,14.5 15.939,20.824 9.615,14.5 7.842,16.274 16,24.432"></polygon></g><g><polygon points="24.158,9.342 22.385,7.568 15.939,13.892 9.615,7.568 7.842,9.342 16,17.5"></polygon></g></g></svg>
                            <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="AnomalyIsExpanded" viewbox="0 0 32 32" title="collapse header"><g><g><polygon points="7.842,15.726 9.615,17.5 16.061,11.176 22.385,17.5 24.158,15.726 16,7.568"></polygon></g><g><polygon points="7.842,22.658 9.615,24.432 16.061,18.108 22.385,24.432 24.158,22.658 16,14.5"></polygon></g></g></svg>
                        </div>
                        <span class="pull-right" style="margin-right:15px;"><small>Number:</small>  <span class="text-info">  {{task.anomalies.length}}</span></span>
                    </div>
                </div>
                <div class="portlet-body"  ng-show="AnomalyIsExpanded"  style="padding:0">
                  <table class="table table-striped table-hover" >
                      <tbody style="text-align:left;">
                          <tr ng-repeat="anomalie in task.anomalies | orderBy:'date'">
                              <td >
                                  <a href="/anomalie/{{anomalie._id}}">
                                    <img src="assets/images/anomaly.png" style="width:20px;height:20px;" alt="">
                                    <small class="dont-break-out"> {{anomalie.name}}</small>
                                  </a >
                              </td>
                              <td style="min-width:70px">
                                  <span class="pull-right text-info">
                                    <a href="task/{{anomalie.correctiveActions[0]._id}}" target="_blank">
                                    <span class="btn btn-outline btn-xs" aria-hidden="false" ng-class="{'btn-info ':anomalie.correctiveActions[0].metrics[0].status === 'In Progress',' btn-default ':anomalie.correctiveActions[0].metrics[0].status === 'Not Started',' btn-danger ':anomalie.correctiveActions.length === 0,' btn-success':anomalie.correctiveActions[0].metrics[0].status === 'Finished'}">CA</span>
                                  </a>
                                  <a href="task/{{anomalie.preventiveActions[0]._id}}" target="_blank">

                                    <span class="btn btn-outline btn-xs" aria-hidden="false" ng-class="{'btn-info ':anomalie.preventiveActions[0].metrics[0].status === 'In Progress',' btn-default ':anomalie.preventiveActions[0].metrics[0].status === 'Not Started',' btn-danger ':anomalie.preventiveActions.length === 0,' btn-success':anomalie.preventiveActions[0].metrics[0].status === 'Finished'}">PA</span>
                                  </a>

                                  </span>
                              </td>
                          </tr>
                      </tbody>
                  </table>
                </div>
            </div>
        </div>
        <!-- Dashboards -->
        <!-- <div class="" id="Dashboards">
            <div class="portlet sale-summary" ng-if="task._id">
                <div class="portlet-title">
                    <div class="caption">
                        Dashboards
                    </div>
                    <div class="tools">
                        <div class="pull-right" ng-init="DashboardIsExpanded=false" ng-click="DashboardIsExpanded=!DashboardIsExpanded">
                            <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="!DashboardIsExpanded" viewbox="0 0 32 32" title="expand header"><g><g><polygon points="24.158,16.274 22.385,14.5 15.939,20.824 9.615,14.5 7.842,16.274 16,24.432"></polygon></g><g><polygon points="24.158,9.342 22.385,7.568 15.939,13.892 9.615,7.568 7.842,9.342 16,17.5"></polygon></g></g></svg>
                            <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="DashboardIsExpanded" viewbox="0 0 32 32" title="collapse header"><g><g><polygon points="7.842,15.726 9.615,17.5 16.061,11.176 22.385,17.5 24.158,15.726 16,7.568"></polygon></g><g><polygon points="7.842,22.658 9.615,24.432 16.061,18.108 22.385,24.432 24.158,22.658 16,14.5"></polygon></g></g></svg>
                        </div>
                        <span class="pull-right" style="margin-right:15px;"><small>Number:</small>  <span class="text-info">  {{task.dashboards.length}}</span></span>
                    </div>
                </div>
                <div class="portlet-body"  ng-show="DashboardIsExpanded">
                    <div tab-dashboard data="task" ng-if="task"></div>
                </div>
            </div>
        </div> -->
    </div>
    <div class="col-md-6 col-sm-12" ng-class="{'label-success':task.metrics[task.metrics.length-1].status ==='Finished','label-lightgrey':task.metrics[task.metrics.length-1].status =='Withdrawn','col-lg-3':!blnRecurrence}" style="padding-bottom:20px;" ng-if="!openedPERT">
        <div class="pdcaCol">
            ACT
        </div>
        <!-- Review -->
        <div class="" id="Review" ng-if="!blnRecurrence">
            <div class="portlet sale-summary" ng-if="task._id">
                <div class="portlet-title">
                    <div class="caption">
                        Review
                    </div>
                    <div class="tools">
                        <div class="pull-right" ng-click="ReviewIsExpanded=!ReviewIsExpanded">
                            <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="!ReviewIsExpanded" viewbox="0 0 32 32" title="expand header"><g><g><polygon points="24.158,16.274 22.385,14.5 15.939,20.824 9.615,14.5 7.842,16.274 16,24.432"></polygon></g><g><polygon points="24.158,9.342 22.385,7.568 15.939,13.892 9.615,7.568 7.842,9.342 16,17.5"></polygon></g></g></svg>
                            <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="ReviewIsExpanded" viewbox="0 0 32 32" title="collapse header"><g><g><polygon points="7.842,15.726 9.615,17.5 16.061,11.176 22.385,17.5 24.158,15.726 16,7.568"></polygon></g><g><polygon points="7.842,22.658 9.615,24.432 16.061,18.108 22.385,24.432 24.158,22.658 16,14.5"></polygon></g></g></svg>
                        </div>
                        <span class="pull-right" style="margin-right:15px;"><small>Number:</small>  <span class="text-info">  {{task.reviews.length ||0}}</span></span>
                    </div>
                </div>
                <div class="portlet-body" style="padding:0!important" ng-show="ReviewIsExpanded">
                  <table class="table table-striped table-hover">
                      <tbody style="text-align:center;">
                        <tr>
                            <td style="text-align:left;">Marked As Success</td>
                            <td style="text-align:right;padding-right:25px;font-size:13px">
                              <div class="circularButtonView circularToggleButtonView-button circularButtonView--xsmall circularButtonView--onWhiteBackground circularButtonView--active" ng-class="task.success ? ' circularToggleButtonView--toggledOn': 'circularToggleButtonView--toggledOff'">
                                <div ng-click="markTaskAsSuccess()"  class="circularButtonView circularToggleButtonView-button circularButtonView--xsmall circularButtonView--onWhiteBackground circularButtonView--active">
                                  <span class="circularButtonView-label">
                                    <svg class="svgIcon " version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                    	 viewbox="0 0 511.999 511.999" style="enable-background:new 0 0 511.999 511.999;" xml:space="preserve" title="trophy">
                                       <path d="M466.45,49.374c-7.065-8.308-17.368-13.071-28.267-13.071H402.41v-11.19C402.41,11.266,391.143,0,377.297,0H134.705
                                         c-13.848,0-25.112,11.266-25.112,25.112v11.19H73.816c-10.899,0-21.203,4.764-28.267,13.071
                                         c-6.992,8.221-10.014,19.019-8.289,29.624c9.4,57.8,45.775,108.863,97.4,136.872c4.717,11.341,10.059,22.083,16.008,32.091
                                         c19.002,31.975,42.625,54.073,68.627,64.76c2.635,26.644-15.094,51.885-41.794,57.9c-0.057,0.013-0.097,0.033-0.153,0.046
                                         c-5.211,1.245-9.09,5.921-9.09,11.513v54.363h-21.986c-19.602,0-35.549,15.947-35.549,35.549v28.058
                                         c0,6.545,5.305,11.85,11.85,11.85H390.56c6.545,0,11.85-5.305,11.85-11.85v-28.058c0-19.602-15.947-35.549-35.549-35.549h-21.988
                                         V382.18c0-5.603-3.893-10.286-9.118-11.52c-0.049-0.012-0.096-0.028-0.145-0.04c-26.902-6.055-44.664-31.55-41.752-58.394
                                         c25.548-10.86,48.757-32.761,67.479-64.264c5.949-10.009,11.29-20.752,16.008-32.095c51.622-28.01,87.995-79.072,97.395-136.87
                                         C476.465,68.392,473.443,57.595,466.45,49.374z M60.652,75.192c-0.616-3.787,0.431-7.504,2.949-10.466
                                         c2.555-3.004,6.277-4.726,10.214-4.726h35.777v21.802c0,34.186,4.363,67.3,12.632,97.583
                                         C89.728,153.706,67.354,116.403,60.652,75.192z M366.861,460.243c6.534,0,11.85,5.316,11.85,11.85v16.208H134.422v-16.208
                                         c0-6.534,5.316-11.85,11.85-11.85H366.861z M321.173,394.03v42.513H191.96V394.03H321.173z M223.037,370.331
                                         c2.929-3.224,5.607-6.719,8.002-10.46c7.897-12.339,12.042-26.357,12.228-40.674c4.209,0.573,8.457,0.88,12.741,0.88
                                         c4.661,0,9.279-0.358,13.852-1.036c0.27,19.239,7.758,37.45,20.349,51.289H223.037z M378.709,81.803
                                         c0,58.379-13.406,113.089-37.747,154.049c-23.192,39.03-53.364,60.525-84.956,60.525c-31.597,0-61.771-21.494-84.966-60.523
                                         c-24.342-40.961-37.748-95.671-37.748-154.049V25.112c0-0.78,0.634-1.413,1.412-1.413h242.591c0.78,0,1.414,0.634,1.414,1.413
                                         V81.803z M451.348,75.192c-6.702,41.208-29.074,78.51-61.569,104.191c8.268-30.283,12.631-63.395,12.631-97.58V60.001h35.773
                                         c3.938,0,7.66,1.723,10.214,4.726C450.915,67.688,451.963,71.405,451.348,75.192z"/>
                                       <path d="M327.941,121.658c-1.395-4.288-5.103-7.414-9.566-8.064l-35.758-5.196l-15.991-32.402
                                         c-1.997-4.044-6.116-6.605-10.626-6.605c-4.511,0-8.63,2.561-10.626,6.605l-15.991,32.402l-35.758,5.196
                                         c-4.464,0.648-8.172,3.775-9.566,8.065c-1.393,4.291-0.231,8.999,2.999,12.148l25.875,25.221l-6.109,35.613
                                         c-0.763,4.446,1.064,8.938,4.714,11.59c3.648,2.651,8.487,3,12.479,0.902L256,190.32l31.982,16.813
                                         c1.734,0.911,3.627,1.36,5.512,1.36c2.456,0,4.902-0.763,6.966-2.263c3.65-2.652,5.477-7.144,4.714-11.59l-6.109-35.613
                                         l25.875-25.221C328.172,130.658,329.334,125.949,327.941,121.658z M278.064,146.405c-2.793,2.722-4.068,6.644-3.408,10.489
                                         l3.102,18.09l-16.245-8.541c-1.725-0.908-3.62-1.36-5.514-1.36c-1.894,0-3.788,0.454-5.514,1.36l-16.245,8.541l3.102-18.09
                                         c0.66-3.844-0.615-7.766-3.408-10.489l-13.141-12.81l18.162-2.64c3.859-0.56,7.196-2.985,8.922-6.482l8.123-16.458l8.122,16.458
                                         c1.727,3.497,5.062,5.921,8.922,6.482l18.162,2.64L278.064,146.405z"/>
                                       </svg>
                                  </span>
                              </div>
                            </div><small class="text-muted" ng-if="task.success">
                              <br>
                              {{task.success}}
                            </small>
                            </td>
                        </tr>
                          <tr>
                              <td style="text-align:left;">Task Review</td>
                              <td style="text-align:right;padding-right:25px;font-size:13px">
                                <div class="circularButtonView circularToggleButtonView-button circularButtonView--xsmall circularButtonView--onWhiteBackground circularButtonView--active" ng-class="task.reviewTask ? ' circularToggleButtonView--toggledOn': 'circularToggleButtonView--toggledOff'">
                                  <div ng-click="changeStatusReviewTask()"  class="circularButtonView circularToggleButtonView-button circularButtonView--xsmall circularButtonView--onWhiteBackground circularButtonView--active">
                                    <span class="circularButtonView-label">
                                      <svg class="svgIcon " viewbox="0 0 32 32" title="checkmark">
                                        <polygon points="27.672,4.786 10.901,21.557 4.328,14.984 1.5,17.812 10.901,27.214 30.5,7.615 "></polygon>
                                      </svg>
                                    </span>
                                </div>
                                </div>
                              </td>
                          </tr>
                          <tr ng-if="1==2">
                              <td style="text-align:left;">Perimeter Review</td>
                              <td style="text-align:right;padding-right:25px;font-size:13px">
                                <div class="circularButtonView circularToggleButtonView-button circularButtonView--xsmall circularButtonView--onWhiteBackground circularButtonView--active">
                                    <span class="circularButtonView-label">
                                      <svg class="svgIcon " viewbox="0 0 32 32" title="checkmark">
                                        <polygon points="27.672,4.786 10.901,21.557 4.328,14.984 1.5,17.812 10.901,27.214 30.5,7.615 "></polygon>
                                      </svg>
                                    </span>
                                </div>
                              </td>
                          </tr>
                      </tbody>
                  </table>
                </div>
            </div>
        </div>
        <div class="" id="ActionPlans" ng-if="!blnRecurrence">
            <div class="portlet sale-summary" ng-if="task._id">
                <div class="portlet-title" >
                    <div class="caption">
                        Action Plan
                    </div>
                    <div class="tools">
                        <div class="pull-right" ng-click="ActionPlanIsExpanded=!ActionPlanIsExpanded">
                            <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="!ActionPlanIsExpanded" viewbox="0 0 32 32" title="expand header"><g><g><polygon points="24.158,16.274 22.385,14.5 15.939,20.824 9.615,14.5 7.842,16.274 16,24.432"></polygon></g><g><polygon points="24.158,9.342 22.385,7.568 15.939,13.892 9.615,7.568 7.842,9.342 16,17.5"></polygon></g></g></svg>
                            <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="ActionPlanIsExpanded" viewbox="0 0 32 32" title="collapse header"><g><g><polygon points="7.842,15.726 9.615,17.5 16.061,11.176 22.385,17.5 24.158,15.726 16,7.568"></polygon></g><g><polygon points="7.842,22.658 9.615,24.432 16.061,18.108 22.385,24.432 24.158,22.658 16,14.5"></polygon></g></g></svg>
                        </div>
                        <span class="pull-right" style="margin-right:15px;"><small>Number:</small>  <span class="text-info">  {{task.ActionPlans.length ||0}}</span></span>
                    </div>
                </div>
                <div class="portlet-body" style="padding:0!important" ng-show="ActionPlanIsExpanded">
                  <table class="table table-striped table-hover" >
                      <tbody style="text-align:left;">
                          <tr ng-repeat="task in task.nextTasks | orderBy:'date'">
                            <td style="text-align: center;max-width:30px;">
                              <img alt="" ng-src="{{task.actors[0].avatar}}" class="img-circle" style="width:30px;height:30px;" err-src="assets/images/avatars/avatar.png" uib-tooltip-html="'Name <br /> {{task.actors[0].name}}'" tooltip-placement="top"/>
                            </td>
                              <td >
                                  <a href="/task/{{task._id}}">
                                    <small class="dont-break-out"> {{task.name}}</small>
                                  </a >
                              </td>
                              <td style="min-width:70px">
                                  <span class="pull-right text-info">
                                    <small class="text-muted" >
                                      {{ (task.metrics[0].targetstartDate | date:'MMM, dd') }} &gt;
                                    </small>
                                    <small style="color:black" >
                                      {{ (task.metrics[0].endDate || task.metrics[0].targetEndDate | date:'MMM, dd') }}
                                    </small>
                                  </span>
                              </td>
                          </tr>
                      </tbody>
                  </table>

                </div>
                <div class="portlet-body" style="margin-top:8px;margin-left:0;margin-right:0;padding-left:0;padding-right:0">
                  <table class="table table-striped table-hover"  >
                      <tbody style="text-align:left;">
                          <tr style="height:40px;background:#eee;text-align:right">
                              <td >
                                  <a href="#" class="btn btn-outline btn-primary btn-xs" ng-click="createActionPlan()">
                                    <i class="fa fa-plus"></i>
                                    <span class="dont-break-out"> Create an Action Plan</span>
                                  </a >
                              </td>
                          </tr>
                      </tbody>
                  </table>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-9 col-sm-12" ng-if="openedPERT">
      <div class="pdcaCol">
          PERT
      </div>

      <!-- Options -->
      <div class="portlet sale-summary">
          <div class="portlet-title">
              <div class="caption">
                  PERT
              </div>
              <div class="tools">
                  <div class="pull-right">
                      <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="!OptionIsExpanded" viewbox="0 0 32 32" title="expand header"><g><g><polygon points="24.158,16.274 22.385,14.5 15.939,20.824 9.615,14.5 7.842,16.274 16,24.432"></polygon></g><g><polygon points="24.158,9.342 22.385,7.568 15.939,13.892 9.615,7.568 7.842,9.342 16,17.5"></polygon></g></g></svg>
                      <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="OptionIsExpanded" viewbox="0 0 32 32" title="collapse header"><g><g><polygon points="7.842,15.726 9.615,17.5 16.061,11.176 22.385,17.5 24.158,15.726 16,7.568"></polygon></g><g><polygon points="7.842,22.658 9.615,24.432 16.061,18.108 22.385,24.432 24.158,22.658 16,14.5"></polygon></g></g></svg>
                  </div>
                  <span class="pull-right" style="margin-right:15px;"><small>Number:</small>  <span class="text-info">  2</span></span>
              </div>
          </div>
          <div class="portlet-body" style="padding:0!important">

            <div class="pertGroup1" ng-repeat="groupPERTTasks in pertTasks | groupBy:'subContext1'">
              {{groupPERTTasks[0].subContext1}}
              <span class="pull-right" style="padding-left:5px;width:100px;font-weight:bold;color:black" uib-tooltip-html="'
                              max: {{ calcAverage(groupPERTTasks).max  }}<br />
                              avg: {{ calcAverage(groupPERTTasks).average  }}<br />
                              min: {{ calcAverage(groupPERTTasks).min  }}<br />
                            '" tooltip-placement="left" >
                {{ parseFloat(((calcAverage(groupPERTTasks, "timeSpent").max +calcAverage(groupPERTTasks, "timeSpent").min+ 4* calcAverage(groupPERTTasks, "timeSpent").average)/6).toFixed(2))}}
              </span>
              <small class="pull-right">PERT: </small>
              <span class="pull-right" style="width:80px;"><small>Number:</small><span style="font-weight:bold;color:black"> {{groupPERTTasks.length}}</span></span>
              <br />
              <div class="pertGroup2" ng-repeat="group2PERTTasks in groupPERTTasks | groupBy:'subContext2'">
                {{group2PERTTasks[0].subContext2}}
                <span class="pull-right" style="padding-left:5px;width:90px;font-weight:bold;color:black" uib-tooltip-html="'
                                max: {{ calcAverage(group2PERTTasks).max  }}<br />
                                avg: {{ calcAverage(group2PERTTasks).average  }}<br />
                                min: {{ calcAverage(group2PERTTasks).min  }}<br />
                              '" tooltip-placement="left" >
                  {{ parseFloat(((calcAverage(group2PERTTasks, "timeSpent").max +calcAverage(group2PERTTasks, "timeSpent").min+ 4* calcAverage(group2PERTTasks, "timeSpent").average)/6).toFixed(2))}}
                </span>
                <small class="pull-right">PERT: </small>
                <span class="pull-right" style="width:80px;"><small>Number:</small><span style="font-weight:bold;color:black"> {{group2PERTTasks.length}}</span></span>

                <br />
              <div class="pertGroup3" ng-repeat="group3PERTTasks in group2PERTTasks | groupBy:'subContext3'">
                {{group3PERTTasks[0].subContext3}}
                <span class="pull-right" style="padding-left:5px;width:80px;font-weight:bold;color:black" uib-tooltip-html="'
                                max: {{ calcAverage(group3PERTTasks).max  }}<br />
                                avg: {{ calcAverage(group3PERTTasks).average  }}<br />
                                min: {{ calcAverage(group3PERTTasks).min  }}<br />
                              '" tooltip-placement="left" >
                  {{ parseFloat(((calcAverage(group3PERTTasks, "timeSpent").max +calcAverage(group3PERTTasks, "timeSpent").min+ 4* calcAverage(group3PERTTasks, "timeSpent").average)/6).toFixed(2))}}
                </span>
                <small class="pull-right">PERT: </small>
                <span class="pull-right" style="width:80px;"><small>Number:</small><span style="font-weight:bold;color:black"> {{group3PERTTasks.length}}</span></span>
                <br />
                <div class="pertGroup4" ng-repeat="group4PERTTasks in group3PERTTasks | groupBy:'subContext4'">
                  {{group4PERTTasks[0].subContext4}}
                  <div class="pull-right" ng-init="expandedPERT[group4PERTTasks[0].subContext4]=(task.context.indexOf(group4PERTTasks[0].subContext4)>=0)" ng-click="expandedPERT[group4PERTTasks[0].subContext4]=!expandedPERT[group4PERTTasks[0].subContext4]">
                      <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="!expandedPERT[group4PERTTasks[0].subContext4]" viewbox="0 0 32 32" title="expand header"><g><g><polygon points="24.158,16.274 22.385,14.5 15.939,20.824 9.615,14.5 7.842,16.274 16,24.432"></polygon></g><g><polygon points="24.158,9.342 22.385,7.568 15.939,13.892 9.615,7.568 7.842,9.342 16,17.5"></polygon></g></g></svg>
                      <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="expandedPERT[group4PERTTasks[0].subContext4]" viewbox="0 0 32 32" title="collapse header"><g><g><polygon points="7.842,15.726 9.615,17.5 16.061,11.176 22.385,17.5 24.158,15.726 16,7.568"></polygon></g><g><polygon points="7.842,22.658 9.615,24.432 16.061,18.108 22.385,24.432 24.158,22.658 16,14.5"></polygon></g></g></svg>
                  </div>
                  <span class="pull-right" style="padding-left:5px;width:55px;font-weight:bold;color:black" uib-tooltip-html="'
                                  max: {{ calcAverage(group4PERTTasks).max  }}<br />
                                  avg: {{ calcAverage(group4PERTTasks).average  }}<br />
                                  min: {{ calcAverage(group4PERTTasks).min  }}<br />
                                '" tooltip-placement="left" >
                    {{ parseFloat(((calcAverage(group4PERTTasks, "timeSpent").max +calcAverage(group4PERTTasks, "timeSpent").min+ 4* calcAverage(group4PERTTasks, "timeSpent").average)/6).toFixed(2))}}
                  </span>
                  <small class="pull-right">PERT: </small>
                  <span class="pull-right" style="width:80px;"><small>Number:</small><span style="font-weight:bold;color:black"> {{group4PERTTasks.length}}</span></span>
                  <br />
                <div class="" ng-show="expandedPERT[group4PERTTasks[0].subContext4]">
                <div class="pertDetail" ng-repeat="pertTask in group4PERTTasks">

                  <span style="width:30px">
                    <img alt="" ng-src="{{pertTask.actors[0].avatar}}" class="img-circle" style="width:30px;height:30px;" err-src="assets/images/avatars/avatar.png" uib-tooltip-html="'Name <br /> {{pertTask.actors[0].name}}'" tooltip-placement="top"/>
                  </span>
                  <span >
                    <a href="/task/{{pertTask._id}}" target="_blank">
                      {{pertTask.name}}
                    </a>
                  </span>
                    <small class="dont-break-out"> {{pertTask.activity}}</small> /
                    <small class="dont-break-out"> {{pertTask.context}}</small>
                    <span class="pull-right days" style="width:80px">
                      {{ pertTask.metrics[0].timeSpent  }}
                    </span>
                  </div>
                </div>


                </div>
                </div>
              </div>
            </div>


          </div>
      </div>
    </div>
</div>
<div class="row" style="padding-top:30px;">
  <div class="col-md-6">
        <span>Audit trail</span>
        <div  style="height:30px;" ng-init="AuditIsExpanded=false" ng-click="AuditIsExpanded=!AuditIsExpanded">
            <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="!AuditIsExpanded" viewbox="0 0 32 32" title="expand header"><g><g><polygon points="24.158,16.274 22.385,14.5 15.939,20.824 9.615,14.5 7.842,16.274 16,24.432"></polygon></g><g><polygon points="24.158,9.342 22.385,7.568 15.939,13.892 9.615,7.568 7.842,9.342 16,17.5"></polygon></g></g></svg>
            <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="AuditIsExpanded" viewbox="0 0 32 32" title="collapse header"><g><g><polygon points="7.842,15.726 9.615,17.5 16.061,11.176 22.385,17.5 24.158,15.726 16,7.568"></polygon></g><g><polygon points="7.842,22.658 9.615,24.432 16.061,18.108 22.385,24.432 24.158,22.658 16,14.5"></polygon></g></g></svg>
        </div>
        <div class="dont-break-out"  ng-show="AuditIsExpanded">
          <div style="height:45px;" ng-show="CommentIsExpanded">
              <div style="display:inline-block;width:100%">
                <input type="text" class="myfilter" name="filterAudit" ng-model="filterAudit" placeholder="Filter Audit" style="margin-left:15px;">
              </div>
          </div>
            <ul class="dont-break-out" style="padding-left:0px;-webkit-padding-start: 0px!important;">
                <li class="todoTask" ng-repeat="comment in task.comments | orderBy:'-date' | filter:filterAudit | filter:auto track by $index" style="min-height:40px;height:auto;padding:10px 0 0 0!important;display:flex;vertical-align: middle;">
                    <div class="" style="min-width:50px;display:flex">
                        <div class="" style="display:inline-flex">
                            <img uib-tooltip-html="'{{comment.user.name}} <br/>
                            {{comment.date | date:'MMM d, y HH:mm '}}'" tooltip-placement="bottom" alt="" ng-src="{{comment.user.avatar}}" style="width:25px;height:25px" ng-class="{'imageTransparent':comment.auto}" class="img-circle" err-src="assets/images/avatars/avatar.png" />
                            <svg ng-if="!comment.auto" style="width:16px;height:16px;color:#B9BCC0;fill:grey;margin-top:-8px;" class="svgIco" viewbox="0 0 32 32" title=""><path d="M19,2c6.065,0,11,4.935,11,11s-4.935,11-11,11h-5.19L8,28.126v-5.282l-0.919-0.59C3.899,20.211,2,16.751,2,13C2,6.935,6.935,2,13,2H19 M19,0h-6C5.832,0,0,5.832,0,13c0,4.59,2.398,8.623,6,10.937V32l8.448-6H19c7.168,0,13-5.832,13-13S26.168,0,19,0L19,0z"></path></svg>
                        </div>
                    </div>
                    <div style="min-width:50px" class="dont-break-out">
                        <span class="dateComment">{{comment.date | date:'d MMM'}}</span>
                    </div>
                    <div class="dont-break-out">
                        <span class="autoComment" ng-if="comment.auto === 2" style="color:rgba(91, 103, 133, 0.5)">{{comment.user.name}} </span>
                        <span class="" ng-class="{'autoComment':comment.auto}" ng-bind-html="comment.text | embed:{sanitizeHtml:false,linkTarget:'_blank'}"></span>
                    </div>
                </li>
            </ul>
        </div>
  </div>
  <div class="col-md-6">
        <span>Debug</span>
            <div  style="height:30px;" ng-init="DebugIsExpanded=false" ng-click="DebugIsExpanded=!DebugIsExpanded">
                <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="!DebugIsExpanded" viewbox="0 0 32 32" title="expand header"><g><g><polygon points="24.158,16.274 22.385,14.5 15.939,20.824 9.615,14.5 7.842,16.274 16,24.432"></polygon></g><g><polygon points="24.158,9.342 22.385,7.568 15.939,13.892 9.615,7.568 7.842,9.342 16,17.5"></polygon></g></g></svg>
                <svg class="svgIcon " style="width:16px;height:16px;color:#B9BCC0;fill:grey" ng-show="DebugIsExpanded" viewbox="0 0 32 32" title="collapse header"><g><g><polygon points="7.842,15.726 9.615,17.5 16.061,11.176 22.385,17.5 24.158,15.726 16,7.568"></polygon></g><g><polygon points="7.842,22.658 9.615,24.432 16.061,18.108 22.385,24.432 24.158,22.658 16,14.5"></polygon></g></g></svg>
            </div>
        <br>
        <pre ng-show="DebugIsExpanded">{{task | json}}</pre>
    </div>
    <!-- END PAGE CONTENT-->
  </div>

</div>
<footer class="navbar-fixed-bottom footer-task-boss">
  <div class="container">
    <!-- big screen -->
    <button type="button" name="button" style="margin-top:2px;margin-right:10px;width:100px;" class="btn btn-primary pull-right"
        ng-if="needToSave && task._id" ng-cloak ng-click="update()"
        ng-disabled="!(task.name && task.context && task.activity && ((task.metrics[task.metrics.length-1].targetstartDate && task.metrics[task.metrics.length-1].targetEndDate) || task.repeats ) && task.metrics[task.metrics.length-1].targetLoad && task.metrics[task.metrics.length-1].trust)"
        uib-tooltip-html="'Save will  copy data to a permanent storage'" tooltip-placement="top" >Save Task</button>
  </div>
</footer>

<!-- END PAGE CONTENT-->


<!-- *************** -->
<!-- MENU DROIT      -->
<!-- *************** -->
<div pageslide ps-open="checked" ps-speed="1" ps-push="true" class="ng-isolate-scope ng-pageslide" style="z-index: 1000; position: fixed;overflow:auto;  transition-duration: 1s; height: 100%; transition-property: top, bottom, left, right; width: 300px; top: 0px; bottom: 0px; right: -300px;background-color:#eee">
                        <div style="padding:20px;margin-top:20px;" id="demo-right">
                            <h3 style="width:100%;text-align:center">Actions on Task</h3>
                            <a class="btn btn-primary" style="width:100%" ng-click="toggle()">Close</a>
                            <hr>


                            <div style="width:100%;  display: inline-block;" ng-click="createAnomaly()">
                              <div style="width:29%;height:70px;float:left">
                                <img src="assets/images/problem.jpg" style="width:60px;" alt="">
                              </div>
                              <div style="width:69%;height:70px;table-cell;   vertical-align: middle; float:left;padding-left:5px" >
                                <p> Report an <u style="font-weight:bold">anomaly</u> that affects your activity </p>
                              </div>
                            </div>
                            <hr>



                            <div style="width:100%;  display: inline-block;"   ng-click="reopen()" ng-if="task.metrics[task.metrics.length-1].status === 'Finished'">
                              <div style="width:29%;height:70px;float:left">
                                <img src="assets/images/rework.png" style="width:60px;z-index:99999" alt="">
                              </div>
                              <div style="width:69%;height:70px;table-cell;   vertical-align: middle; float:left;padding-left:5px" >
                                <p><u style="font-weight:bold">ReOpen</u> a finished tasks to redo something</p>
                              </div>
                            </div>
                            <hr ng-if="task.metrics[task.metrics.length-1].status === 'Finished'">

                            <br><br>
                            <div style="width:100%;  display: inline-block;"   ng-click="refreshTask()">
                              <div style="width:29%;height:70px;float:left">
                                <img src="assets/images/refresh-icon.png" style="width:60px;" alt="">
                              </div>
                              <div style="width:69%;height:70px;table-cell;   vertical-align: middle; float:left;padding-left:5px">
                                <p>Resfresh will operate again all calculations</p>
                              </div>
                            </div>
                            <hr>
                            <div style="width:100%;  display: inline-block;"   ng-click="createNewTask('both')" ng-class="{'activeActionMenu':dashboardSlide === 'Home'}">
                              <div style="width:29%;height:70px;float:left" >
                                <img src="assets/images/Copy.png" style="width:60px;" alt="">
                              </div>
                              <div style="width:69%;height:70px;table-cell;   vertical-align: middle; float:left;padding-left:5px" >
                                <p><u style="font-weight:bold">Clone</u> this tasks to create a new one with one or more similar properties</p>
                              </div>
                            </div>
                            <hr>
                            <div style="width:100%;  display: inline-block;"   ng-click="delete()">
                              <div style="width:29%;height:70px;float:left">
                                <img src="assets/images/delete.png" style="width:60px;" alt="">
                              </div>
                              <div style="width:69%;height:70px; display: table-cell;   vertical-align: middle; float:left;padding-left:5px">
                                <p>Delete <u style="font-weight:bold">forever</u> this task</p>
                              </div>
                            </div>
                            <hr>




                        </div>
                    </div>
